import{j as e,b as q,c as Y,d as J,e as I,f as W,g as K,V as U,h as Q,i as X,a as Z,L as ee,y as c}from"./index-ljsycxTj.js";import{r as s}from"./vendor-DTxvXAp4.js";import{i as te,j as ae,p as re,k as se,f as oe,l as ne}from"./api-B-uGkXoi.js";import{a as M,S as le}from"./skeleton-CMDJjVTa.js";import{r as G,e as H,D as T}from"./el-DrlHR-bP.js";import"./memoize-one.esm-Bwxuo8OZ.js";G("el",H);const de=({customerId:d,onClose:m})=>{const[r,f]=s.useState(null),[E,j]=s.useState(!0),[v,p]=s.useState(!1),[u,h]=s.useState(null),[C,F]=s.useState([]),[L,g]=s.useState(!0),[i,b]=s.useState(!1),[l,w]=s.useState({name:"",phoneNumber:"",dateOfBirth:""}),[y,S]=s.useState(!1),[D,k]=s.useState(!1);if(s.useEffect(()=>{d&&(j(!0),te(d).then(a=>f(a)).finally(()=>j(!1)))},[d]),s.useEffect(()=>{r&&w({name:r.name||"",phoneNumber:r.phoneNumber||"",dateOfBirth:r.dateOfBirth?r.dateOfBirth.slice(0,10):""})},[r]),s.useEffect(()=>{d&&(g(!0),ae(d).then(a=>F(a)).finally(()=>g(!1)))},[d]),!d)return null;const O=()=>b(!0),P=()=>{w({name:r.name||"",phoneNumber:r.phoneNumber||"",dateOfBirth:r.dateOfBirth?r.dateOfBirth.slice(0,10):""}),b(!1)},N=(a,o)=>{w(n=>({...n,[a]:o}))},A=async()=>{if(!l.name||!l.phoneNumber){U("Name and phone are required.",{icon:"⚠️"});return}S(!0);try{const a=await re(d,l);f(a),b(!1)}catch{U.error("Failed to update.")}finally{S(!1)}},R=async a=>{const o=a.target.files[0];if(o){p(!0),h(null);try{const n=await se(d,o);f(n)}catch{h("Upload failed. Try again.")}finally{p(!1)}}},t=!(l.name!==((r==null?void 0:r.name)||"")||l.phoneNumber!==((r==null?void 0:r.phoneNumber)||"")||l.dateOfBirth!==(r!=null&&r.dateOfBirth?r.dateOfBirth.slice(0,10):""))||!l.name||!l.phoneNumber||y;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex justify-end z-50",onClick:m,children:e.jsxs("div",{className:"relative w-full max-w-sm h-full bg-[#161a23] p-8 overflow-y-auto transition-all border-l border-[#a78bfa] rounded-r-2xl flex flex-col items-center",style:{boxShadow:"0 8px 40px #0008"},onClick:a=>a.stopPropagation(),children:[e.jsx("button",{className:"absolute top-5 right-5 text-[#7c72a6] hover:text-[#a78bfa] text-2xl",onClick:m,"aria-label":"Close",children:"×"}),E?e.jsx("div",{className:"text-[#a78bfa] text-center mt-20",children:"Loading..."}):r?e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8 w-full",children:[r.profilePicture?e.jsx("img",{src:r.profilePicture,alt:"Profile",className:"w-28 h-28 rounded-full border-4 border-[#a78bfa] shadow-xl mb-3 object-cover"}):e.jsx(q,{className:"w-28 h-28 text-[#393a50] mb-3"}),e.jsxs("label",{className:"bg-[#a78bfa] text-[#161a23] font-semibold px-5 py-2 rounded-lg cursor-pointer hover:bg-[#ede9fe] transition mb-2 text-base shadow-md",htmlFor:"profilePhotoInput",children:[v?"Uploading...":"Add/Change Photo",e.jsx("input",{id:"profilePhotoInput",type:"file",accept:"image/*",onChange:R,disabled:v,className:"hidden"})]}),u&&e.jsx("div",{className:"text-[#e879f9] text-xs mt-2",children:u}),e.jsx("h2",{className:"text-2xl font-bold text-[#ede9fe] text-center flex items-center gap-2 w-full justify-center mt-2 tracking-wide",children:i?e.jsx("input",{value:l.name,onChange:a=>N("name",a.target.value),className:"bg-[#181c2b] text-[#ede9fe] border-b border-[#a78bfa] px-3 py-2 rounded w-full sm:w-44 focus:outline-none focus:ring-2 focus:ring-[#a78bfa]"}):e.jsxs(e.Fragment,{children:[r.name,e.jsx("button",{onClick:O,className:"ml-2 text-[#a78bfa] hover:text-[#ede9fe]",title:"Edit Profile",children:e.jsx(Y,{})})]})}),e.jsx("p",{className:"text-l text-[#9ba3ce] text-center flex items-center gap-2 w-full justify-center mt-2 tracking-wide",children:i?e.jsx("input",{value:l.phoneNumber,onChange:a=>N("phoneNumber",a.target.value),className:"bg-[#181c2b] text-[#ede9fe] border-b border-[#a78bfa] px-3 py-2 rounded w-full sm:w-44 focus:outline-none focus:ring-2 focus:ring-[#a78bfa]",type:"tel"}):r.phoneNumber}),e.jsxs("div",{className:"w-full flex items-center justify-between bg-[#23263b] border border-[#a78bfa] rounded-xl px-5 py-3 mt-4 mb-5",children:[e.jsx("span",{className:"font-medium text-[#ede9fe]",children:"Birthday:"}),i?e.jsx(T,{selected:l.dateOfBirth?new Date(l.dateOfBirth):null,onChange:a=>N("dateOfBirth",a?a.toISOString().slice(0,10):""),dateFormat:"dd/MM/yyyy",placeholderText:"Επιλέξτε ημερομηνία",showYearDropdown:!0,scrollableYearDropdown:!0,yearDropdownItemNumber:120,minDate:new Date(1920,0,1),maxDate:new Date,className:"w-full sm:w-44",calendarClassName:"!bg-[#161a23] !text-[#ede9fe] !rounded-lg !border !border-[#a78bfa]",locale:"el",weekStartsOn:1}):r.dateOfBirth?e.jsx("span",{className:"font-semibold text-[#a78bfa]",children:new Date(r.dateOfBirth).toLocaleDateString("el-GR")}):e.jsx("button",{onClick:O,className:"birthday-link",children:"Add Birthday"})]})]}),i&&e.jsxs("div",{className:"flex justify-center gap-3 mb-4",children:[e.jsxs("button",{onClick:A,disabled:t,className:`bg-[#a78bfa] text-[#161a23] font-bold px-6 py-2 rounded-lg hover:bg-[#ede9fe] hover:text-[#181c2b] shadow transition flex items-center gap-2 ${t?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx(J,{})," ",y?"Saving...":"Save"]}),e.jsxs("button",{onClick:P,className:"bg-[#393a50] text-[#ede9fe] font-bold px-6 py-2 rounded-lg hover:bg-[#23263b] shadow transition flex items-center gap-2",children:[e.jsx(I,{})," Cancel"]})]}),e.jsxs("div",{className:"w-full mt-2",children:[e.jsxs("button",{onClick:()=>k(a=>!a),className:"flex items-center justify-between w-full bg-[#a78bfa] px-6 py-4 rounded-xl cursor-pointer border-0 shadow-md text-lg font-bold text-[#161a23] tracking-wide transition",children:["Ιστορικό ραντεβού",e.jsxs("span",{className:"ml-3 font-extrabold",children:["(",C.length,")"]}),D?e.jsx(W,{}):e.jsx(K,{})]}),D&&e.jsx("div",{className:"bg-[#161a23] rounded-b-xl border border-t-0 border-[#a78bfa] py-1",children:L?e.jsx("div",{className:"text-[#a78bfa] text-center py-3",children:"Loading..."}):C.length===0?e.jsx("div",{className:"text-[#7c72a6] text-center py-3",children:"No appointments found."}):e.jsx("ul",{className:"divide-y divide-[#23263b]",children:C.map((a,o)=>e.jsxs("li",{className:"py-2 flex justify-between items-center px-4",children:[e.jsx("span",{className:"text-[#ede9fe]",children:new Date(a.appointmentDateTime).toLocaleString("el-GR",{day:"2-digit",month:"2-digit",year:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsx("span",{className:`font-bold ml-2 ${a.barber==="ΛΕΜΟ"?"text-[#a78bfa]":"text-orange-400"}`,children:a.barber})]},o))})})]})]}):e.jsx("div",{className:"text-red-400",children:"Customer not found."})]})})};G("el",H);const V="http://localhost:5002/api",B=[{value:"ΛΕΜΟ",label:"ΛΕΜΟ"},{value:"ΦΟΡΟΥ",label:"ΦΟΡΟΥ"}],_={ΛΕΜΟ:"text-purple-600",ΦΟΡΟΥ:"text-orange-500"},he=()=>{const[d,m]=s.useState([]),[r,f]=s.useState(null),[E,j]=s.useState(null),[v,p]=s.useState(null),[u,h]=s.useState({name:"",phoneNumber:"",barber:"",dateOfBirth:""}),[C,F]=s.useState(!0),[L,g]=s.useState(!1),[i,b]=s.useState({name:"",phoneNumber:"",barber:"",dateOfBirth:""}),[l,w]=s.useState(!1),y=s.useRef(null);s.useEffect(()=>{(async()=>{try{const o=(await oe()).map(n=>({...n,barberColor:_[n.barber]||"text-white"}));m(o.sort((n,x)=>n.name.localeCompare(x.name)))}catch(a){console.error("Error fetching customers:",a)}finally{F(!1)}})()},[]),s.useEffect(()=>{const t=a=>{y.current&&!y.current.contains(a.target)&&p(null)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]);const S=async t=>{if(window.confirm("Θέλετε σίγουρα να διαγράψετε τον πελάτη; Η ενέργεια δεν αναιρείται."))try{if(!(await fetch(`${V}/customers/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete customer");m(n=>n.filter(x=>x._id!==t)),c.success("Ο πελάτης διαγράφηκε!")}catch(o){c.error("Αποτυχία διαγραφής πελάτη."),console.error("Error deleting customer:",o)}},D=t=>{p(t._id),h({name:t.name,phoneNumber:t.phoneNumber,barber:t.barber||"",dateOfBirth:t.dateOfBirth||""})},k=t=>{const{name:a,value:o}=t.target;h(n=>({...n,[a]:o}))},O=t=>{h(a=>({...a,barber:t.value}))},P=async t=>{try{const a=await fetch(`${V}/customers/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!a.ok){a.status===409?c.error("Υπάρχει ήδη πελάτης με αυτό το τηλέφωνο."):c.error("Αποτυχία ενημέρωσης πελάτη.");return}const o=await a.json(),n={...o,barberColor:_[o.barber]||"text-white"};m(x=>x.map(z=>z._id===t?n:z)),p(null),c.success("Επιτυχής ενημέρωση πελάτη!")}catch(a){c.error("Αποτυχία ενημέρωσης πελάτη."),console.error("Error updating customer:",a)}},N=t=>{const{name:a,value:o}=t.target;b(n=>({...n,[a]:o}))},A=t=>{b(a=>({...a,barber:t.value}))},R=async t=>{if(t.preventDefault(),!i.name||!i.phoneNumber){c.error("Το όνομα και το τηλέφωνο είναι υποχρεωτικά πεδία.");return}w(!0);try{const a=await ne(i);m(o=>[...o,{...a,barberColor:_[a.barber]||"text-white"}].sort((n,x)=>n.name.localeCompare(x.name))),g(!1),b({name:"",phoneNumber:"",barber:"",dateOfBirth:""}),c.success("Ο πελάτης προστέθηκε!")}catch(a){a&&a.message&&a.message.includes("already exists")?c.error("Υπάρχει ήδη πελάτης με αυτό το τηλέφωνο."):c.error("Αποτυχία προσθήκης πελάτη."),console.error("Error adding customer:",a)}finally{w(!1)}},$=d.map(t=>({value:t._id,label:`${t.name} - ${t.phoneNumber}`}));return e.jsxs("div",{className:"p-6 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"ΠΕΛΑΤΕΣ"}),e.jsxs("button",{className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded flex items-center gap-2 shadow font-semibold",onClick:()=>g(t=>!t),children:[e.jsx(Q,{})," Προσθήκη Πελάτη"]})]}),L&&e.jsxs("form",{onSubmit:R,className:"flex flex-wrap items-end gap-4 bg-[#1e293b] border border-[#3b82f6] p-4 rounded-xl mb-6",children:[e.jsx("input",{type:"text",name:"name",placeholder:"Όνομα",value:i.name,onChange:N,className:"w-44 bg-[#181c2b] text-[#ede9fe] border border-[#a78bfa] px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-[#a78bfa]",autoFocus:!0}),e.jsx("input",{type:"text",name:"phoneNumber",placeholder:"Τηλέφωνο",value:i.phoneNumber,onChange:N,className:"w-44 bg-[#181c2b] text-[#ede9fe] border border-[#a78bfa] px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-[#a78bfa]"}),e.jsx(M,{options:B,placeholder:"Επιλέξτε Barber",value:B.find(t=>t.value===i.barber),onChange:A,className:"w-44",styles:{control:(t,a)=>({...t,backgroundColor:"#181c2b",borderColor:"#a78bfa",color:"#ede9fe",borderRadius:"8px",padding:"2px 0px",fontSize:"15px",boxShadow:a.isFocused?"0 0 0 2px #a78bfa55":void 0}),menu:t=>({...t,backgroundColor:"#161a23",color:"#ede9fe",borderRadius:"8px"}),option:(t,a)=>({...t,backgroundColor:a.isFocused?"#3b82f6":"#161a23",color:"#ede9fe",padding:"10px"}),singleValue:t=>({...t,color:"#ede9fe"}),placeholder:t=>({...t,color:"#9ca3af"}),input:t=>({...t,color:"#ede9fe"})}}),e.jsx(T,{selected:i.dateOfBirth?new Date(i.dateOfBirth):null,onChange:t=>b(a=>({...a,dateOfBirth:t?t.toISOString().slice(0,10):""})),dateFormat:"dd/MM/yyyy",placeholderText:"Ημερ. Γέννησης",className:"w-44 bg-[#181c2b] text-[#ede9fe] border border-[#a78bfa] px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-[#a78bfa]",calendarClassName:"!bg-[#161a23] !text-[#ede9fe]",locale:"el",yearDropdownItemNumber:100,showYearDropdown:!0,scrollableYearDropdown:!0,maxDate:new Date}),e.jsx("button",{type:"submit",disabled:l,className:"bg-[#a78bfa] hover:bg-[#ede9fe] hover:text-[#161a23] text-[#161a23] font-bold px-6 py-2 rounded-lg shadow transition",style:{height:"44px"},children:l?"Προσθήκη...":"Αποθήκευση"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"bg-red-500 text-white px-3 py-2 rounded shadow font-semibold",style:{height:"44px"},children:e.jsx(I,{})})]}),C?e.jsx(le,{count:5,height:30,className:"mb-4"}):d.length===0?e.jsx("p",{className:"text-white",children:"ΔΕΝ ΒΡΕΘΗΚΑΝ ΠΕΛΑΤΕΣ."}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 w-full max-w-md",children:e.jsx(M,{options:$,placeholder:"Αναζήτηση Πελάτη",isClearable:!0,isSearchable:!0,value:E,onChange:t=>{j(t),f(t?t.value:null)},styles:{control:t=>({...t,backgroundColor:"#1e293b",borderColor:"#3b82f6",color:"white",borderRadius:"8px",padding:"5px",fontSize:"14px"}),menu:t=>({...t,backgroundColor:"#1e293b",color:"white",borderRadius:"8px"}),option:(t,a)=>({...t,backgroundColor:a.isFocused?"#3b82f6":"#1e293b",color:"white",padding:"10px"}),singleValue:t=>({...t,color:"white"}),placeholder:t=>({...t,color:"#9ca3af"}),input:t=>({...t,color:"white"})}})}),e.jsx("ul",{className:"space-y-2 overflow-y-auto",style:{maxHeight:"400px"},children:d.map(t=>e.jsxs("li",{className:`flex justify-between items-center border-b pb-2 ${t.barberColor}`,children:[v===t._id?e.jsxs("div",{className:"flex-grow",ref:y,children:[e.jsx("input",{type:"text",name:"name",value:u.name,onChange:k,className:"p-2 rounded border bg-white text-black"}),e.jsx("input",{type:"text",name:"phoneNumber",value:u.phoneNumber,onChange:k,className:"p-2 rounded border ml-2 bg-white text-black"}),e.jsx(M,{options:B,placeholder:"Επιλέξτε Barber",value:B.find(a=>a.value===u.barber),onChange:O,styles:{control:a=>({...a,backgroundColor:"#1e293b",color:"white",borderColor:"#3b82f6",borderRadius:"8px",padding:"5px",fontSize:"14px",width:"200px"}),menu:a=>({...a,backgroundColor:"#1e293b",color:"white",borderRadius:"8px",width:"200px"}),option:(a,o)=>({...a,backgroundColor:o.isFocused?"#3b82f6":"#1e293b",color:"white",padding:"10px"}),singleValue:a=>({...a,color:"white"}),placeholder:a=>({...a,color:"#9ca3af"})}}),e.jsx(T,{selected:u.dateOfBirth?new Date(u.dateOfBirth):null,onChange:a=>h(o=>({...o,dateOfBirth:a?a.toISOString().slice(0,10):""})),dateFormat:"dd/MM/yyyy",placeholderText:"Ημερ. Γέννησης",className:"w-44 bg-[#181c2b] text-[#ede9fe] border-b border-[#a78bfa] px-3 py-2 rounded",calendarClassName:"!bg-[#161a23] !text-[#ede9fe]",locale:"el",yearDropdownItemNumber:100,showYearDropdown:!0,scrollableYearDropdown:!0,maxDate:new Date}),e.jsx("button",{onClick:()=>P(t._id),className:"px-2 py-1 bg-green-500 text-white rounded",children:"ΑΠΟΘΗΚΕΥΣΗ"})]}):e.jsxs("div",{className:"flex-grow",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsx("span",{className:"ml-4",children:t.phoneNumber})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>D(t),className:"text-blue-500 hover:text-blue-700",children:e.jsx(Y,{size:20})}),e.jsx("button",{onClick:()=>f(t._id),className:"text-cyan-400 hover:text-cyan-600",title:"View Details",children:e.jsx(X,{size:20})}),e.jsx("button",{onClick:()=>S(t._id),className:"text-red-500 hover:text-red-700",children:e.jsx(Z,{size:20})})]})]},t._id))})]}),r&&e.jsx(de,{customerId:r,onClose:()=>{f(null),j(null)}}),e.jsx(ee,{position:"top-right",autoClose:2500})]})};export{he as default};
